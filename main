#!/usr/bin/bash

# â”€â”€â”€ ANSI Colors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

#################################---LOCK---##########################

LOCKDIR="/tmp/mydbms.lockdir"

# Try to create the lock directory
if ! mkdir "$LOCKDIR" 2>/dev/null; then
   echo -e "${RED}[Error] âŒ Another instance is already running. Exiting.${NC}"
  exit 1
fi

# Ensure we clean up the lock on *any* exit
trap 'rmdir "$LOCKDIR"' EXIT

echo -e "${GREEN}[Success] âœ” Lock acquired, running DBMSâ€¦${NC}"

#########################---PrintScreen---#########################
    clear

line="       ${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
text="             ğŸ’¾ Welcome To DBMS Bash Project ğŸ’¾"

# Print top border
echo -e "$line"

# Print animated text WITH color applied before the loop
echo -ne "${CYAN}"
for ((i=0; i<${#text}; i++)); do
  echo -ne "${text:$i:1}"
  sleep 0.02
done
echo -e "${NC}"

# Print bottom border
echo -e "$line"


#####################----Program----###########################

while true 
do
    clear
    echo -e "       ${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "             ğŸ’¾ Welcome To DBMS Bash Project ğŸ’¾"
    echo -e "       ${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  
    PS3="ğŸ“Œ Enter your choice (1-5): "
    select action in "ğŸ› ï¸  Create a database" "ğŸ“‚ List all databases" "ğŸ”— Connect to a database" "ğŸ—‘ï¸ Drop a database" "ğŸšª Exit DBMS"
    do
        case "$action" in
            "ğŸ› ï¸  Create a database")
                ./createDB
                break
                ;;

            "ğŸ“‚ List all databases")
                ./listAllDB
                read -r -p "ğŸ“˜ Press any key to continue..." -n1 -s
                echo
                break
                ;;

            "ğŸ”— Connect to a database")
               ./connectToDB
                break
                ;;

            "ğŸ—‘ï¸ Drop a database")
                read -p "ğŸ—‘ï¸ Enter the name of the database to delete: " dbname
                ./dropDB "$dbname"
                break
                ;;

            "ğŸšª Exit DBMS")
                echo -e "${YELLOW}[Info] ğŸ”š Exiting DBMS. Goodbye!${NC}"
                exit
                ;;

            *)
                echo -e "${YELLOW}[Warning] âš ï¸  Invalid input. Please choose a valid option.${NC}"
                ;;
        esac
    done
done
